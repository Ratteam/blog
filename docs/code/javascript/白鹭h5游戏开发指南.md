## Egret引擎介绍

免费

开源

跨平台

使用TypeScript开发

结构简单

## 开发工具安装

安装node.js

安装egret引擎

## egret命令行介绍

egret help 查看命令

create                        创建新项目

build                         构建指定项目,编译指定项目的 TypeScript 文件

publish                       发布项目，使用GoogleClosureCompiler压缩代码

run                           启动HttpServer,并在默认浏览器中打开指定项目

clean                         重置项目中的引擎代码

create_lib                    创建新第三方库项目

create_app                    从h5游戏生成app

upgrade                       升级项目代码

make                          编译引擎源码

info                          获得Egret信息

## 创建第一个egret项目

```
egret create demo
```

**各文件含义**

- egretProperties.json：项目配置文件

- src：项目源代码目录。source code的缩写。

- libs：项目运行库。

  项目各模块所对应的所有类库。对egretProperties.json进行修改后，需要用project->build engine来重新生成项目运行库。

- bin-debug：项目编译目录。

  这文件夹包含调试运行过程中会调用到的所有文件。其中源代码目录的文件会被编译到bin-debug/src目录中。bin-debug/lib有个列表文件，用来列出项目需要的所有运行库文件。

- esource：项目资源目录。

  存放项目运行所需要的所有资源。包括图片和配置文件。通常在资源目录建立一个资源清单文件，默认为resource.json。
  图片或声音等资源文件的默认目录为resource/assets。配置数据文件的默认存储目录为resource/config。

- bin-release：项目发布目录。

## egret中的显示列表

## egret的事件机制

在Egret中，事件模型定义了一套标准的生成和处理事件消息的方法，使程序中的对象可以相互交互，通信，保持自身状态和相应变化。简单的说，数据的提供者只管发出数据对象，只要确保数据对象是 egret.Event 类或者子类的实例即可。这种数据对象 ，称为事件（Event）。数据对象的发出者，称之为事件发送者（Event dispatcher）。同时，接受事件的对象，称为 事件侦听者（Event listener)。

## 开发工具

egret工具集

## 游戏资源处理

TextureMerger 制作图片集

打开TextureMerger，选择Sprite Sheet

将多张图片拖拽到工具，生成一张图

点击导出，导出资源

## 加载游戏资源

打开EgretWing，点击文件——新建项目
打开cmd控制台——输入`egret run -a`将项目启动

打开ResDepot——选择打开D:\egret\shenjinmao\resource\default.res.json配置文件

全选删除旧资源

将纹理集资源拖到工具里

新建一个组，将纹理集资源拖住到新建的组里

在入口文件Main.ts中编辑

```
class Main extends egret.DisplayObjectContainer {
    public constructor() {
        super();
        this.addEventListener(egret.Event.ADDED_TO_STAGE, this.onAddToStage, this);
    }

    private onAddToStage(event: egret.Event) {
        // 初始化Resource资源加载库 GROUP_COMPLETE加载组，加载完后调用自定义方法onGroupComplete
        RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGroupComplete,this);
        // 加载配置文件
        RES.loadConfig("resource/default.res.json", "resource/");
        // 加载组
        RES.loadGroup("gameres");
    }
    // 调用
    private onGroupComplete(){

    }
}
```



## 图片纹理集的处理

在res文件夹中新建文件夹view,用于存放所有和界面有关的代码

生成游戏背景代码如下：

view/ViewManage.ts

```
class ViewManage extends egret.EventDispatcher {
    // 设置egret全局属性
    private _rootView: egret.DisplayObjectContainer;
    private _textures: egret.SpriteSheet;
    // 构造函数
    public constructor(root: egret.DisplayObjectContainer, textures: egret.SpriteSheet) {
        // 继承 egret.EventDispatcher 传递事件
        super();
        this._rootView = root;
        this._textures = textures;
        var bg: egret.Bitmap = new egret.Bitmap();
        // 通过 getTexture()方法 来获取贴图资源
        bg.texture = this._textures.getTexture("bg");
        // 将背景添加到页面
        this._rootView.addChild(bg);
    }
}
```

Main.ts

```
class Main extends egret.DisplayObjectContainer {
    public constructor() {
        super();
        this.addEventListener(egret.Event.ADDED_TO_STAGE, this.onAddToStage, this);
    }
    private onAddToStage(event: egret.Event) {
        // 初始化Resource资源加载库 GROUP_COMPLETE加载组，加载完后调用自定义方法onGroupComplete
        RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE, this.OnGroupComplete, this);
        this.loadResource();
    }
    // 创建ViewManage变量
    private _viewManage: ViewManage;
    private OnGroupComplete() {
        // 通过getRes获取纹理集，传递参数给ViewManage处理背景
        this._viewManage = new ViewManage(this, RES.getRes('gameres_json'));
    }
    private async loadResource() {
        try {
            const loadingView = new LoadingUI();
            this.stage.addChild(loadingView);
            // 加载配置文件
            await RES.loadConfig("resource/default.res.json", "resource/");
            // 加载组
            await RES.loadGroup("gameres", 0, loadingView);
            this.stage.removeChild(loadingView);
        }
        catch (e) {
            console.error(e);
        }
    }
}
```

## 开始游戏界面制作
view/StartGamePanel.ts
```
class StartGamePanel extends egret.Sprite{

    public constructor(textures: egret.SpriteSheet){
        super();
        var startgameBigmap: egret.Bitmap = new egret.Bitmap();
        startgameBigmap.texture = textures.getTexture("btn_start");
        this.width = 400;
        this.height = 588;
        this.touchEnabled = true;
        this.x = (egret.MainContext.instance.stage.$stageWidth - this.width)/2;
        this.y = (egret.MainContext.instance.stage.$stageHeight - this.height)/2;
    }
}
```

## 游戏背景界面制作
view/BackGroundPanel.ts
```
class BackGroundPanel extends egret.Bitmap{

    public constructor(root: egret.DisplayObjectContainer, textures: egret.SpriteSheet){
        super();
        this.texture = textures.getTexture("bg");
        root.addChild(this);
    }
}
```

## 游戏成功面板制作
view/GameOverPanelS.ts
```
class GameOverPanelS extends egret.Sprite {

    public constructor(textures: egret.SpriteSheet) {
        super();
        var gameOverPanelS: egret.Bitmap = new egret.Bitmap();
        gameOverPanelS.texture = textures.getTexture("victory");
        this.addChild(gameOverPanelS);
        this.width = 448;
        this.height = 338;
        this.x = (egret.MainContext.instance.stage.$stageWidth - this.width) / 2;
        this.y = (egret.MainContext.instance.stage.$stageHeight - this.height) / 2;
    }
}
```

## 游戏失败面板制作
view/GameOverPanelF.ts
```
class GameOverPanelF extends egret.Sprite{

    public constructor(textures: egret.SpriteSheet){
        super();
        // 创建位图
        var gameOverPanelF: egret.Bitmap = new egret.Bitmap();
        gameOverPanelF.texture = textures.getTexture("failed")
        this.addChild(gameOverPanelF);
        this.width = 448;
        this.height = 361;
        this.x = (egret.MainContext.instance.stage.$stageWidth - this.width)/2;
        this.y = (egret.MainContext.instance.stage.$stageHeight - this.height)/2;
    }
}
```

## 游戏结束面板制作

view/GameOverButtonPanel.ts

```
class GameOverButtonPanel extends egret.Sprite{
    public _reStartBtn: egret.Sprite;

    public constructor(textures:egret.SpriteSheet){
        super();
        // 实例化
        this._reStartBtn = new egret.Sprite();
        // 设置宽高
        this._reStartBtn.width = 200;
        this._reStartBtn.height = 103;
        // 定义bitmap
        var bitmap: egret.Bitmap = new egret.Bitmap();
        // 赋值
        bitmap.texture  = textures.getTexture("replay");
        // 添加到页面
        this._reStartBtn.addChild(bitmap);
        // 设置可以接收鼠标点击事件
        this._reStartBtn.touchEnabled = true; 
        // 设置显示在面板中
        this.addChild(this._reStartBtn);
        // 设置位置
        this._reStartBtn.x = (egret.MainContext.instance.stage.$stageWidth - this._reStartBtn.width)/2;
        this._reStartBtn.y = egret.MainContext.instance.stage.$stageHeight - 200;
    }
}
```

## 神经猫的动画资源处理

## 制作神经猫动画

## 算法工具类的编写

## 地图元素制作

## 地图排序算法编写

## 视图管理器

## 其他界面逻辑

## 数据管理器的创建

## 创建寻路数据元素

## 创建寻路算法AI类

## 寻找周围可走范围算法

## 判断出口点算法

## 随机走路算法

## 寻找最短路径算法

## 文档类的编写

## 激活视图管理器

## 编写游戏开始逻辑

## 编写地图事件响应函数

## 测试游戏

## 美化界面

## 将游戏打包

